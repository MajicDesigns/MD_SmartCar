<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Smart Car Controller: Tuning PID Parameters</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="MajicDesigns_Logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Smart Car Controller
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">Library to manage a two wheeled robotic vehicle (DC Motors)</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('page_setup_p_i_d.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Tuning PID Parameters </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The next step is to use the <b>Calibrate</b> example sketch and the SerialStudio application (found at <a href="https://www.alex-spataru.com/serial-studio.html">https://www.alex-spataru.com/serial-studio.html</a>) to determine the motor control PID parameters. The IDE Serial Monitor can be used to view the raw numbers output from the library whilst tuning the PID loop; SerialStudio provides superior data visualization and an easier tuning process.</p>
<p><b>Calibrate</b> allows the vehicle motors to be controlled through the Serial Monitor using a command line interface (CLI) to invoke test the functions (type ? for help text listing the functions). SerialStudio replaces the IDE Serial Monitor and adds real-time graphical plots of the PID control parameters.</p>
<p>Whilst setting parameters, it is a good idea to save to EEPROM using the CLI when a good set of Kp, Ki and Kd parameters are found. The saved parameters can be reloaded from EEPROM at any time, especially when changes make the PID tuning worse.</p>
<h4>Setting up for PID Tuning</h4>
<ol type="1">
<li>Edit <a class="el" href="_m_d___smart_car_8h.html" title="Main header file and class definition for the MD_SmartCar library.">MD_SmartCar.h</a> and change <div class="fragment"><div class="line"><span class="preprocessor">#define PID_TUNE 0 </span></div>
</div><!-- fragment --> to <div class="fragment"><div class="line"><span class="preprocessor">#define PID_TUNE 1 </span></div>
</div><!-- fragment --> This will enable the library to output PID control parameters as JSON data. Once tuning is completed, this defined value should be changed back to 0 to suppress output.</li>
<li>Compile and download the <b>Calibrate</b> sketch with this setting turned on.</li>
<li>Start the SerialStudio application and configure it as shown in the figure below<ul>
<li>Set the Serial Parameters - COM port and baud rate - in the red highlight box.</li>
<li>Set the JSON file to 'Manual' and choose the <em>PID.json</em> file in the library <em>src</em> folder (orange highlight box). Check the Settings tab and set the Start and End sequences to '{' and '}'. This will make SerialStudio recognise the PID output data packets in the received Serial stream.</li>
<li>Connect the serial port to the vehicle (yellow highlight box).</li>
</ul>
</li>
</ol>
<p><img src="SmartCar_SerialStudio.png" alt="" class="inline" title="SmartCar SerialStudio Setup"/></p>
<p>SerialStudio has the same input functionality as the Serial Monitor. You can type commands to the vehicle application using the console input box (light blue highlight). The figure shows the result of the '?' command (help text).</p>
<h4>PID Tuning</h4>
<p>Once SerialStudio is set up, starting the motors from the console will automatically switch to a graphical dashboard view, shown below. This allows you to visualize the effects of changes to the speed setpoints and/or the PID parameters. You can switch between console and dashboard views using the menu options at the top of the window.</p>
<p>Parameters shown are Set Point (SP), Current Value (CV) and control Output (CO) for the Left and Right motors.</p>
<p><img src="SmartCar_PIDsetup.png" alt="" class="inline" title="SmartCar SerialStudio Dashboard"/></p>
<p>The default PID values in the SmartCar_HW header file should be a good starting point for the PID motor settings - expect to have a high Kp, no Ki and a relatively small Kd (this is really a PD controller). PID values can be set independently for Left and Right motors if required. In most cases the same PID setup for both motors should be adequate.</p>
<p>Once you are happy with the performance of the PID control loop, save the parameters to EEPROM.</p>
<p>Next: <a class="el" href="page_setup_control.html">Testing with Remote Control</a> </p><hr  />
 </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Sat Jul 31 2021 16:32:30 for Smart Car Controller by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
